import React, { useState } from 'react';
import { AlertCircle, TrendingUp, TrendingDown, Users, DollarSign, Heart, Shield } from 'lucide-react';

export default function PresidentSimulator() {
  const [gameState, setGameState] = useState({
    country: 'Rep√∫blica de Nova Terra',
    president: '',
    year: 1,
    maxYears: 4,
    stats: {
      economy: 50,
      popularity: 50,
      education: 50,
      security: 50,
      health: 50
    },
    budget: 100,
    events: [],
    gameOver: false,
    victory: false
  });

  const [started, setStarted] = useState(false);
  const [currentEvent, setCurrentEvent] = useState(null);

  const events = [
    {
      id: 1,
      title: 'Crise Econ√¥mica',
      description: 'A economia est√° em recess√£o. O desemprego aumentou e a infla√ß√£o est√° subindo.',
      options: [
        { text: 'Investir em obras p√∫blicas', economy: 10, budget: -20, popularity: 5 },
        { text: 'Reduzir impostos', economy: 5, budget: -15, popularity: 10 },
        { text: 'Cortar gastos p√∫blicos', economy: -5, budget: 15, popularity: -15 }
      ]
    },
    {
      id: 2,
      title: 'Reforma na Educa√ß√£o',
      description: 'Professores exigem melhores sal√°rios e escolas precisam de reformas.',
      options: [
        { text: 'Aumentar sal√°rios dos professores', education: 15, budget: -25, popularity: 10 },
        { text: 'Reformar escolas', education: 10, budget: -15, popularity: 5 },
        { text: 'Manter status quo', education: -10, budget: 0, popularity: -10 }
      ]
    },
    {
      id: 3,
      title: 'Onda de Criminalidade',
      description: 'Os √≠ndices de criminalidade aumentaram nas grandes cidades.',
      options: [
        { text: 'Contratar mais policiais', security: 15, budget: -20, popularity: 5 },
        { text: 'Investir em preven√ß√£o', security: 10, education: 5, budget: -15, popularity: 10 },
        { text: 'Endurecer leis', security: 5, budget: 0, popularity: -5 }
      ]
    },
    {
      id: 4,
      title: 'Pandemia',
      description: 'Uma doen√ßa contagiosa est√° se espalhando pelo pa√≠s.',
      options: [
        { text: 'Lockdown total', health: 20, economy: -15, popularity: -10, budget: -15 },
        { text: 'Investir em hospitais', health: 15, budget: -25, popularity: 5 },
        { text: 'Medidas moderadas', health: 5, economy: -5, popularity: 0, budget: -5 }
      ]
    },
    {
      id: 5,
      title: 'Proposta de Alian√ßa',
      description: 'Um pa√≠s vizinho prop√µe uma alian√ßa comercial ben√©fica.',
      options: [
        { text: 'Aceitar alian√ßa', economy: 15, popularity: 10, budget: 10 },
        { text: 'Negociar termos', economy: 10, popularity: 5, budget: 5 },
        { text: 'Recusar', economy: -5, popularity: -5, budget: 0 }
      ]
    },
    {
      id: 6,
      title: 'Desastre Natural',
      description: 'Um terremoto atingiu uma regi√£o importante do pa√≠s.',
      options: [
        { text: 'Ajuda emergencial massiva', popularity: 20, budget: -30, economy: -5 },
        { text: 'Ajuda moderada', popularity: 10, budget: -15, economy: -3 },
        { text: 'Ajuda m√≠nima', popularity: -15, budget: -5, economy: -2 }
      ]
    },
    {
      id: 7,
      title: 'Esc√¢ndalo de Corrup√ß√£o',
      description: 'Membros do seu governo foram acusados de corrup√ß√£o.',
      options: [
        { text: 'Investiga√ß√£o total', popularity: 15, budget: -10, economy: -5 },
        { text: 'Demitir acusados', popularity: 5, budget: 0, economy: -3 },
        { text: 'Defender governo', popularity: -20, budget: 0, economy: 0 }
      ]
    },
    {
      id: 8,
      title: 'Boom Econ√¥mico',
      description: 'Descoberta de recursos naturais impulsiona a economia!',
      options: [
        { text: 'Investir em infraestrutura', economy: 15, education: 5, budget: 20 },
        { text: 'Distribuir renda', popularity: 20, economy: 5, budget: 10 },
        { text: 'Guardar reservas', budget: 30, economy: 10, popularity: -5 }
      ]
    }
  ];

  const startGame = (name) => {
    if (!name.trim()) return;
    setGameState({
      ...gameState,
      president: name
    });
    setStarted(true);
    generateEvent();
  };

  const generateEvent = () => {
    const randomEvent = events[Math.floor(Math.random() * events.length)];
    setCurrentEvent(randomEvent);
  };

  const handleDecision = (option) => {
    let newStats = { ...gameState.stats };
    let newBudget = gameState.budget;

    // Aplicar efeitos da decis√£o
    Object.keys(option).forEach(key => {
      if (key !== 'text') {
        if (key === 'budget') {
          newBudget += option[key];
        } else if (newStats[key] !== undefined) {
          newStats[key] = Math.max(0, Math.min(100, newStats[key] + option[key]));
        }
      }
    });

    // Verificar condi√ß√µes de derrota
    const avgStats = Object.values(newStats).reduce((a, b) => a + b) / Object.values(newStats).length;
    
    if (newStats.popularity < 20 || avgStats < 25 || newBudget < -50) {
      setGameState({
        ...gameState,
        stats: newStats,
        budget: newBudget,
        gameOver: true,
        victory: false
      });
      setCurrentEvent(null);
      return;
    }

    // Avan√ßar ano
    const newYear = gameState.year + 1;
    
    if (newYear > gameState.maxYears) {
      // Vit√≥ria
      setGameState({
        ...gameState,
        stats: newStats,
        budget: newBudget,
        year: newYear,
        gameOver: true,
        victory: avgStats >= 50 && newStats.popularity >= 40
      });
      setCurrentEvent(null);
    } else {
      setGameState({
        ...gameState,
        stats: newStats,
        budget: newBudget,
        year: newYear
      });
      generateEvent();
    }
  };

  const resetGame = () => {
    setGameState({
      country: 'Rep√∫blica de Nova Terra',
      president: '',
      year: 1,
      maxYears: 4,
      stats: {
        economy: 50,
        popularity: 50,
        education: 50,
        security: 50,
        health: 50
      },
      budget: 100,
      events: [],
      gameOver: false,
      victory: false
    });
    setStarted(false);
    setCurrentEvent(null);
  };

  const getStatColor = (value) => {
    if (value >= 70) return 'bg-green-500';
    if (value >= 40) return 'bg-yellow-500';
    return 'bg-red-500';
  };

  if (!started) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-blue-900 via-blue-700 to-blue-500 p-8 flex items-center justify-center">
        <div className="bg-white rounded-lg shadow-2xl p-8 max-w-md w-full">
          <h1 className="text-4xl font-bold text-center text-blue-900 mb-4">
            üèõÔ∏è Simulador de Presidente
          </h1>
          <p className="text-gray-700 text-center mb-6">
            Voc√™ foi eleito presidente da {gameState.country}! Seu mandato durar√° {gameState.maxYears} anos. Tome decis√µes s√°bias para manter o pa√≠s pr√≥spero!
          </p>
          <input
            type="text"
            placeholder="Digite seu nome"
            className="w-full p-3 border-2 border-blue-300 rounded-lg mb-4 text-lg"
            onKeyPress={(e) => {
              if (e.key === 'Enter') {
                startGame(e.target.value);
              }
            }}
          />
          <button
            onClick={(e) => {
              const input = e.target.previousSibling;
              startGame(input.value);
            }}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition"
          >
            Iniciar Mandato
          </button>
        </div>
      </div>
    );
  }

  if (gameState.gameOver) {
    return (
      <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-700 to-gray-500 p-8 flex items-center justify-center">
        <div className="bg-white rounded-lg shadow-2xl p-8 max-w-2xl w-full">
          <h1 className="text-4xl font-bold text-center mb-6">
            {gameState.victory ? 'üéâ Vit√≥ria!' : 'üòî Fim do Mandato'}
          </h1>
          <p className="text-xl text-center mb-8">
            {gameState.victory 
              ? `Parab√©ns, Presidente ${gameState.president}! Voc√™ completou seu mandato com sucesso e deixou o pa√≠s em boas condi√ß√µes!`
              : `Infelizmente, Presidente ${gameState.president}, voc√™ foi destitu√≠do do cargo antes do fim do mandato. O pa√≠s est√° em crise.`
            }
          </p>
          
          <div className="space-y-4 mb-8">
            <h2 className="text-2xl font-bold text-center">Estat√≠sticas Finais</h2>
            <div className="grid grid-cols-2 gap-4">
              <div className="bg-blue-100 p-4 rounded-lg">
                <div className="flex items-center gap-2 mb-2">
                  <DollarSign className="text-blue-600" />
                  <span className="font-bold">Economia</span>
                </div>
                <div className="text-3xl font-bold text-blue-600">{gameState.stats.economy}%</div>
              </div>
              <div className="bg-purple-100 p-4 rounded-lg">
                <div className="flex items-center gap-2 mb-2">
                  <Users className="text-purple-600" />
                  <span className="font-bold">Popularidade</span>
                </div>
                <div className="text-3xl font-bold text-purple-600">{gameState.stats.popularity}%</div>
              </div>
              <div className="bg-yellow-100 p-4 rounded-lg">
                <div className="flex items-center gap-2 mb-2">
                  <TrendingUp className="text-yellow-600" />
                  <span className="font-bold">Educa√ß√£o</span>
                </div>
                <div className="text-3xl font-bold text-yellow-600">{gameState.stats.education}%</div>
              </div>
              <div className="bg-red-100 p-4 rounded-lg">
                <div className="flex items-center gap-2 mb-2">
                  <Shield className="text-red-600" />
                  <span className="font-bold">Seguran√ßa</span>
                </div>
                <div className="text-3xl font-bold text-red-600">{gameState.stats.security}%</div>
              </div>
              <div className="bg-green-100 p-4 rounded-lg col-span-2">
                <div className="flex items-center gap-2 mb-2">
                  <Heart className="text-green-600" />
                  <span className="font-bold">Sa√∫de</span>
                </div>
                <div className="text-3xl font-bold text-green-600">{gameState.stats.health}%</div>
              </div>
            </div>
          </div>

          <button
            onClick={resetGame}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-6 rounded-lg text-lg transition"
          >
            Jogar Novamente
          </button>
        </div>
      </div>
    );
  }

  return (
    <div className="min-h-screen bg-gradient-to-br from-indigo-900 via-purple-800 to-pink-700 p-4">
      <div className="max-w-4xl mx-auto">
        {/* Header */}
        <div className="bg-white rounded-lg shadow-xl p-6 mb-4">
          <div className="flex justify-between items-center mb-4">
            <div>
              <h1 className="text-2xl font-bold text-gray-800">Presidente {gameState.president}</h1>
              <p className="text-gray-600">{gameState.country}</p>
            </div>
            <div className="text-right">
              <div className="text-3xl font-bold text-blue-600">Ano {gameState.year}/{gameState.maxYears}</div>
              <div className="text-lg">Or√ßamento: 
                <span className={gameState.budget >= 0 ? 'text-green-600 font-bold' : 'text-red-600 font-bold'}>
                  {gameState.budget > 0 ? '+' : ''}{gameState.budget}B
                </span>
              </div>
            </div>
          </div>

          {/* Stats */}
          <div className="grid grid-cols-5 gap-2">
            {Object.entries(gameState.stats).map(([key, value]) => {
              const icons = {
                economy: DollarSign,
                popularity: Users,
                education: TrendingUp,
                security: Shield,
                health: Heart
              };
              const Icon = icons[key];
              const labels = {
                economy: 'Economia',
                popularity: 'Popularidade',
                education: 'Educa√ß√£o',
                security: 'Seguran√ßa',
                health: 'Sa√∫de'
              };
              
              return (
                <div key={key} className="text-center">
                  <Icon className="mx-auto mb-1 text-gray-600" size={20} />
                  <div className="text-xs text-gray-600 mb-1">{labels[key]}</div>
                  <div className="bg-gray-200 rounded-full h-2 mb-1">
                    <div 
                      className={`h-2 rounded-full ${getStatColor(value)}`}
                      style={{ width: `${value}%` }}
                    />
                  </div>
                  <div className="text-xs font-bold">{value}%</div>
                </div>
              );
            })}
          </div>
        </div>

        {/* Event */}
        {currentEvent && (
          <div className="bg-white rounded-lg shadow-xl p-6">
            <div className="flex items-start gap-3 mb-4">
              <AlertCircle className="text-yellow-500 flex-shrink-0 mt-1" size={24} />
              <div>
                <h2 className="text-2xl font-bold text-gray-800 mb-2">{currentEvent.title}</h2>
                <p className="text-gray-700">{currentEvent.description}</p>
              </div>
            </div>

            <div className="space-y-3">
              {currentEvent.options.map((option, index) => (
                <button
                  key={index}
                  onClick={() => handleDecision(option)}
                  className="w-full bg-gradient-to-r from-blue-500 to-purple-600 hover:from-blue-600 hover:to-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition text-left"
                >
                  {option.text}
                </button>
              ))}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}
